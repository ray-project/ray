group: cicd-cron
steps:
  - name: manylinux-cibase
    label: ":crescent_moon: wanda: manylinux-cibase"
    wanda: ci/docker/manylinux-cibase.wanda.yaml
    env:
      RAYCI_DISABLE_JAVA: "true"
      JDK_SUFFIX: ""

  - name: manylinux-cibase-jdk
    label: ":crescent_moon: wanda: manylinux-cibase (with JDK)"
    wanda: ci/docker/manylinux-cibase.wanda.yaml
    env:
      RAYCI_DISABLE_JAVA: "false"
      JDK_SUFFIX: "-jdk"

  - label: ":crescent_moon: push: Push manylinux to Docker Hub"
    depends_on:
      - manylinux-cibase
      - forge
    job_env: forge
    commands:
      - bazel run //.buildkite:copy_files -- --destination docker_login
      # NOTE(andrew-anyscale): Not running w/ --upload while we verify builds
      # are scheduling and completing correctly.
      - bazel run //ci/ray_ci/automation:copy_wanda_image --
        --wanda-image-name manylinux-cibase
        --destination-registry rayproject/manylinux2014_cibase_x86_64

  - label: ":crescent_moon: push: Push manylinux (with JDK) to Docker Hub"
    depends_on:
      - manylinux-cibase-jdk
      - forge
    job_env: forge
    commands:
      - bazel run //.buildkite:copy_files -- --destination docker_login
      # NOTE(andrew-anyscale): Not running w/ --upload while we verify builds
      # are scheduling and completing correctly.
      - bazel run //ci/ray_ci/automation:copy_wanda_image --
        --wanda-image-name manylinux-cibase-jdk
        --destination-registry rayproject/manylinux2014_cibase_jdk_x86_64
