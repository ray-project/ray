group: Custom images build
steps:
- label: ':tapioca: build custom: ray-project/ray-ml:abc123-custom'
  key: custom_build_ray_project_ray_ml_abc123_custom
  instance_type: release-medium
  commands:
  - pip3 install --user -U pip
  - pip3 install --user -r release/requirements_buildkite.txt
  - pip3 install --user --no-deps -e release/
  - pip3 install --user awscli
  - aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin
    029272617770.dkr.ecr.us-west-2.amazonaws.com
  - python release/ray_release/scripts/custom_byod_build.py --image-name ray-project/ray-ml:abc123-custom
    --base-image ray-project/ray-ml:abc123-base --post-build-script custom_script.sh
  depends_on: anyscalemlbuild
- label: ':tapioca: build custom: ray-project/ray-ml:nightly-py37-cpu-custom-abcdef123456789abc123456789'
  key: custom_build_7_cpu_custom_abcdef123456789abc123456789
  instance_type: release-medium
  commands:
  - pip3 install --user -U pip
  - pip3 install --user -r release/requirements_buildkite.txt
  - pip3 install --user --no-deps -e release/
  - pip3 install --user awscli
  - aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin
    029272617770.dkr.ecr.us-west-2.amazonaws.com
  - python release/ray_release/scripts/custom_byod_build.py --image-name ray-project/ray-ml:nightly-py37-cpu-custom-abcdef123456789abc123456789
    --base-image ray-project/ray-ml:nightly-py37-cpu-base --post-build-script custom_script.sh
  depends_on: anyscalemlbuild
