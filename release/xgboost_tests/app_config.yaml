base_image: "anyscale/ray:1.2.0"
env_vars: {}
debian_packages:
  - curl

python:
  pip_packages:
    - pytest
    - xgboost_ray
    - petastorm
  conda_packages: []

post_build_cmds:
  - pip uninstall -y numpy ray || true
  - sudo rm -rf /home/ray/anaconda3/lib/python3.7/site-packages/numpy
  - pip3 install numpy || true
  - pip3 install -U {{ env["RAY_WHEELS"] | default("ray") }}
  - sudo mkdir -p /data || true
  - sudo chown ray:1000 /data || true
  - rm -rf /data/classification.parquet || true
  - curl -so create_test_data.py https://raw.githubusercontent.com/ray-project/ray/releases/1.3.0/release/xgboost_tests/create_test_data.py
  - python create_test_data.py /data/classification.parquet --seed 1234 --num-rows 1000000 --num-cols 40 --num-partitions 100 --num-classes 2
  - curl -so /home/ray/anaconda3/lib/python3.7/site-packages/ray/tune/utils/release_test_util.py https://raw.githubusercontent.com/krfricke/ray/0e14a4c40b7b462f81ef7bcf7cbdc4941a0bfd28/python/ray/tune/utils/release_test_util.py
  - curl -so /home/ray/anaconda3/lib/python3.7/site-packages/ray/util/xgboost/release_test_util.py https://raw.githubusercontent.com/krfricke/ray/f0bf365943314dae4664e7226e52afbede94bcf3/python/ray/util/xgboost/release_test_util.py
