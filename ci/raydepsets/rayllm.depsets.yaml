build_arg_sets:
  - name: cpu
    build_args:
      CUDA_CODE: cpu
  - name: cu121
    build_args:
      CUDA_CODE: cu121
  - name: cu128
    build_args:
      CUDA_CODE: cu128

depsets:
  - name: ray_base_test_depset
    requirements:
      - python/requirements.txt
      - python/requirements/cloud-requirements.txt
      - python/requirements/base-test-requirements.txt
    constraints:
      - tmp/ray-deps/requirements_compiled.txt
    output: python/requirements_compiled_ray_test_py311_${CUDA_CODE}.txt
    operation: compile
    override_flags:
      - --extra-index-url https://download.pytorch.org/whl/${CUDA_CODE}
    build_arg_sets:
      - cpu
      - cu121
      - cu128

  - name: compiled_ray_llm_test_depset
    operation: expand
    requirements:
      - python/requirements.txt
      - python/requirements/cloud-requirements.txt
      - python/requirements/base-test-requirements.txt
      - python/requirements/llm/llm-requirements.txt
      - python/requirements/llm/llm-test-requirements.txt
    constraints:
      - python/requirements_compiled_ray_test_py311_${CUDA_CODE}.txt
    output: python/requirements_compiled_rayllm_test_py311_${CUDA_CODE}.txt
    override_flags:
      - --extra-index-url https://download.pytorch.org/whl/${CUDA_CODE}
    build_arg_sets:
      - cpu
      - cu121
      - cu128

  - name: compiled_ray_depset
    operation: subset
    source_depset: ray_base_test_depset
    requirements:
      - python/requirements.txt
    output: python/requirements_compiled_ray_py311_${CUDA_CODE}.txt
    override_flags:
      - --extra-index-url https://download.pytorch.org/whl/${CUDA_CODE}
    build_arg_sets:
      - cpu
      - cu121
      - cu128

  - name: compiled_ray_llm_depset
    operation: subset
    source_depset: compiled_ray_llm_test_depset
    requirements:
      - python/requirements.txt
      - python/requirements/llm/llm-requirements.txt
    output: python/requirements_compiled_rayllm_py311_${CUDA_CODE}.txt
    override_flags:
      - --extra-index-url https://download.pytorch.org/whl/${CUDA_CODE}
    build_arg_sets:
      - cpu
      - cu121
      - cu128
