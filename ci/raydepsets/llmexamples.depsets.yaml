build_arg_sets:
  py39:
    PYTHON_VERSION: "3.9"
    PYTHON_SHORT: "39"
  py310:
    PYTHON_VERSION: "3.10"
    PYTHON_SHORT: "310"
  py311_gpu:
    PYTHON_VERSION: "3.11"
    PYTHON_SHORT: "311"
    CUDA_VERSION: "gpu"
  py312:
    PYTHON_VERSION: "3.12"
    PYTHON_SHORT: "312"

common_settings: &common_settings
  override_flags:
    - --extra-index-url https://download.pytorch.org/whl/${CUDA_CODE}
  append_flags:
    - --python-version=3.11
    - --python-platform=linux
  build_arg_sets:
    - cu128

depsets:
  - name: distributing_pytorch_ray_depset_${PYTHON_SHORT}_${CUDA_VERSION}
    packages:
      - ray[all]==100.0.0-dev
    requirements:
      - doc/source/train/examples/pytorch/distributing-pytorch/requirements.in
    output: release/ray_release/byod/distributing_pytorch_py${PYTHON_SHORT}_${CUDA_VERSION}.lock
    operation: compile
    append_flags:
      - --python-version=${PYTHON_VERSION}
      - --find-links=.whl/
      - --extra-index-url https://download.pytorch.org/whl/${CUDA_VERSION}
    build_arg_sets:
      - py311_gpu
    pre_hooks:
      - ci/raydepsets/pre_hooks/build-placeholder-wheel.sh ${PYTHON_VERSION}
