# Test container with Ray installed from pre-built artifacts.
#
# This builds on top of a team build image (e.g., corebuild-py3.10) and installs
# Ray using pre-built C++ artifacts from ray-core and ray-dashboard images.
#
# Required environment variables:
#   IMAGE_TO       - Base image name (e.g., corebuild-py3.10, databuild-py3.11)
#   PYTHON_VERSION - Python version (3.9, 3.10, 3.11, 3.12, 3.13)
#
# Optional environment variables:
#   BUILD_TYPE     - Build type (optimized, debug, asan, etc.) - default: optimized
#   ARCH_SUFFIX    - Architecture suffix (empty for x86_64, -aarch64 for ARM)
#
# Usage:
#   IMAGE_TO=corebuild-py3.10 PYTHON_VERSION=3.10 wanda ci/docker/tests.env.wanda.yaml
#
name: "$IMAGE_TO-ray"
froms:
  - "cr.ray.io/rayproject/$IMAGE_TO"
  - "cr.ray.io/rayproject/ray-core-py$PYTHON_VERSION$ARCH_SUFFIX"
  - "cr.ray.io/rayproject/ray-dashboard"
dockerfile: ci/ray_ci/tests.env.Dockerfile
srcs:
  - python/
  - rllib/
  - cpp/
  - java/
  - ci/
  - src/
  - .bazelrc
  - .bazelversion
  - BUILD.bazel
  - WORKSPACE
  - README.rst
  - pyproject.toml
build_args:
  - BASE_IMAGE=cr.ray.io/rayproject/$IMAGE_TO
  - RAY_CORE_IMAGE=cr.ray.io/rayproject/ray-core-py$PYTHON_VERSION$ARCH_SUFFIX
  - RAY_DASHBOARD_IMAGE=cr.ray.io/rayproject/ray-dashboard
  - BUILD_TYPE=$BUILD_TYPE
  - BUILDKITE_CACHE_READONLY
  - HOSTTYPE
tags:
  - cr.ray.io/rayproject/$IMAGE_TO-ray
